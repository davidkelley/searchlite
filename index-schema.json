{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/davidkelley/searchlite/index-schema.json",
  "title": "Searchlite Index Schema",
  "description": "Defines the structure of schema.json files used to build Searchlite indexes.",
  "type": "object",
  "additionalProperties": false,
  "required": ["text_fields", "keyword_fields", "numeric_fields"],
  "properties": {
    "doc_id_field": {
      "type": "string",
      "description": "Name of the string primary key field expected on every document.",
      "default": "_id",
      "minLength": 1
    },
    "analyzers": {
      "type": "array",
      "description": "Optional custom analyzers composed of a tokenizer and token filters.",
      "items": { "$ref": "#/$defs/analyzer" },
      "default": []
    },
    "text_fields": {
      "type": "array",
      "description": "Top-level text fields to tokenize and index.",
      "items": { "$ref": "#/$defs/text_field" },
      "default": []
    },
    "keyword_fields": {
      "type": "array",
      "description": "Top-level keyword fields for exact matches and filters.",
      "items": { "$ref": "#/$defs/keyword_field" },
      "default": []
    },
    "numeric_fields": {
      "type": "array",
      "description": "Top-level numeric fields for range queries and aggregations.",
      "items": { "$ref": "#/$defs/numeric_field" },
      "default": []
    },
    "nested_fields": {
      "type": "array",
      "description": "Nested objects whose child fields are flattened to dotted paths.",
      "items": { "$ref": "#/$defs/nested_field" },
      "default": []
    },
    "vector_fields": {
      "type": "array",
      "description": "Optional dense vector fields (requires the `vectors` feature).",
      "items": { "$ref": "#/$defs/vector_field" },
      "default": []
    }
  },
  "$defs": {
    "analyzer": {
      "type": "object",
      "description": "Named analyzer consisting of a tokenizer and optional filters.",
      "additionalProperties": false,
      "required": ["name", "tokenizer"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Unique analyzer identifier referenced by text fields."
        },
        "tokenizer": {
          "type": "string",
          "minLength": 1,
          "description": "Built-in tokenizer name (`default`, `unicode`, or `whitespace`)."
        },
        "filters": {
          "type": "array",
          "items": { "$ref": "#/$defs/token_filter" },
          "default": [],
          "description": "Ordered token filters applied after tokenization."
        }
      }
    },
    "token_filter": {
      "description": "Token filters applied after tokenization.",
      "oneOf": [
        {
          "type": "object",
          "required": ["lowercase"],
          "additionalProperties": false,
          "properties": {
            "lowercase": { "type": "boolean", "description": "Lowercase tokens using Unicode rules." }
          }
        },
        {
          "type": "object",
          "required": ["stopwords"],
          "additionalProperties": false,
          "properties": {
            "stopwords": {
              "$ref": "#/$defs/stopwords_config",
              "description": "Built-in list name (e.g., `en`) or explicit array."
            }
          }
        },
        {
          "type": "object",
          "required": ["stemmer"],
          "additionalProperties": false,
          "properties": {
            "stemmer": {
              "type": "string",
              "description": "Stemmer language (e.g., `english`)."
            }
          }
        },
        {
          "type": "object",
          "required": ["synonyms"],
          "additionalProperties": false,
          "properties": {
            "synonyms": {
              "type": "array",
              "items": { "$ref": "#/$defs/synonym_rule" },
              "description": "Synonym expansion rules applied at the same token position."
            }
          }
        },
        {
          "type": "object",
          "required": ["edge_ngram"],
          "additionalProperties": false,
          "properties": {
            "edge_ngram": { "$ref": "#/$defs/edge_ngram" }
          }
        }
      ]
    },
    "stopwords_config": {
      "oneOf": [
        { "type": "string" },
        { "type": "array", "items": { "type": "string" } }
      ]
    },
    "synonym_rule": {
      "type": "object",
      "additionalProperties": false,
      "required": ["from", "to"],
      "properties": {
        "from": { "type": "array", "items": { "type": "string" } },
        "to": { "type": "array", "items": { "type": "string" } }
      }
    },
    "edge_ngram": {
      "type": "object",
      "additionalProperties": false,
      "required": ["min", "max"],
      "properties": {
        "min": { "type": "integer", "minimum": 1 },
        "max": { "type": "integer", "minimum": 1 }
      }
    },
    "search_as_you_type": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "min_gram": { "type": "integer", "minimum": 1, "default": 1 },
        "max_gram": { "type": "integer", "minimum": 1, "default": 15 }
      },
      "description": "Convenience flag that adds an edge_ngram filter to the index analyzer while keeping the search analyzer unchanged."
    },
    "text_field": {
      "type": "object",
      "description": "Tokenized text column stored in postings and optionally in the doc store.",
      "additionalProperties": false,
      "required": ["name", "stored", "indexed"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Field name used in documents and queries."
        },
        "analyzer": {
          "type": "string",
          "minLength": 1,
          "description": "Analyzer identifier applied at index time."
        },
        "tokenizer": {
          "type": "string",
          "minLength": 1,
          "description": "Deprecated alias for `analyzer`."
        },
        "search_analyzer": {
          "type": "string",
          "minLength": 1,
          "description": "Optional analyzer to use at search time."
        },
        "search_tokenizer": {
          "type": "string",
          "minLength": 1,
          "description": "Deprecated alias for `search_analyzer`."
        },
        "stored": {
          "type": "boolean",
          "description": "Keep raw field values for retrieval and snippets."
        },
        "indexed": {
          "type": "boolean",
          "description": "Index tokenized terms to make the field searchable."
        },
        "nullable": {
          "type": "boolean",
          "description": "Permit null values in documents for this field.",
          "default": false
        },
        "search_as_you_type": {
          "$ref": "#/$defs/search_as_you_type",
          "description": "Enable edge n-gram indexing for search-as-you-type queries."
        }
      },
      "allOf": [
        {
          "anyOf": [
            { "required": ["analyzer"] },
            { "required": ["tokenizer"] },
            { "required": ["search_as_you_type"] }
          ]
        },
        { "not": { "required": ["analyzer", "tokenizer"] } },
        { "not": { "required": ["search_analyzer", "search_tokenizer"] } }
      ]
    },
    "keyword_field": {
      "type": "object",
      "description": "Keyword (untokenized) field for exact matches and fast filtering.",
      "additionalProperties": false,
      "required": ["name", "stored", "indexed", "fast"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Field name used in documents and filters."
        },
        "stored": {
          "type": "boolean",
          "description": "Keep raw keyword values for retrieval."
        },
        "indexed": {
          "type": "boolean",
          "description": "Index keyword terms for matching."
        },
        "fast": {
          "type": "boolean",
          "description": "Expose as a fast field to enable filters and aggregations."
        },
        "nullable": {
          "type": "boolean",
          "description": "Permit null values in documents for this field.",
          "default": false
        }
      }
    },
    "numeric_field": {
      "type": "object",
      "description": "Numeric field (i64 or f64) used for range queries and aggregations.",
      "additionalProperties": false,
      "required": ["name", "i64", "fast"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Field name used in documents and filters."
        },
        "i64": {
          "type": "boolean",
          "description": "When true store as a signed 64-bit integer; otherwise store as f64."
        },
        "fast": {
          "type": "boolean",
          "description": "Expose as a fast field to enable filters and aggregations."
        },
        "stored": {
          "type": "boolean",
          "description": "Keep numeric values in the doc store for retrieval.",
          "default": false
        },
        "nullable": {
          "type": "boolean",
          "description": "Permit null values in documents for this field.",
          "default": false
        }
      }
    },
    "nested_field": {
      "type": "object",
      "description": "Nested object whose child fields are validated per object and stored separately.",
      "additionalProperties": false,
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Name of the nested object as it appears in documents."
        },
        "fields": {
          "type": "array",
          "description": "Fields contained within this nested object.",
          "items": { "$ref": "#/$defs/nested_property" },
          "default": []
        },
        "nullable": {
          "type": "boolean",
          "description": "Allow the entire object to be null in documents.",
          "default": false
        }
      }
    },
    "nested_property": {
      "description": "Field definitions allowed inside a nested object. Each entry must declare its type.",
      "oneOf": [
        { "$ref": "#/$defs/nested_text_property" },
        { "$ref": "#/$defs/nested_keyword_property" },
        { "$ref": "#/$defs/nested_numeric_property" },
        { "$ref": "#/$defs/nested_object_property" }
      ]
    },
    "nested_text_property": {
      "type": "object",
      "description": "Text field within a nested object.",
      "additionalProperties": false,
      "required": ["type", "name", "stored", "indexed"],
      "properties": {
        "type": {
          "const": "text",
          "description": "Marks this nested field as text."
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Field name relative to its parent object."
        },
        "analyzer": {
          "type": "string",
          "minLength": 1,
          "description": "Analyzer identifier applied at index time."
        },
        "tokenizer": {
          "type": "string",
          "minLength": 1,
          "description": "Deprecated alias for `analyzer`."
        },
        "search_analyzer": {
          "type": "string",
          "minLength": 1,
          "description": "Optional analyzer to use at search time."
        },
        "search_tokenizer": {
          "type": "string",
          "minLength": 1,
          "description": "Deprecated alias for `search_analyzer`."
        },
        "stored": {
          "type": "boolean",
          "description": "Keep raw field values for retrieval and snippets."
        },
        "indexed": {
          "type": "boolean",
          "description": "Index tokenized terms to make the field searchable."
        },
        "nullable": {
          "type": "boolean",
          "description": "Permit null values in documents for this field.",
          "default": false
        },
        "search_as_you_type": {
          "$ref": "#/$defs/search_as_you_type",
          "description": "Enable edge n-gram indexing for search-as-you-type queries."
        }
      },
      "allOf": [
        {
          "anyOf": [
            { "required": ["analyzer"] },
            { "required": ["tokenizer"] }
          ]
        },
        { "not": { "required": ["analyzer", "tokenizer"] } },
        { "not": { "required": ["search_analyzer", "search_tokenizer"] } }
      ]
    },
    "nested_keyword_property": {
      "type": "object",
      "description": "Keyword field within a nested object.",
      "additionalProperties": false,
      "required": ["type", "name", "stored", "indexed", "fast"],
      "properties": {
        "type": {
          "const": "keyword",
          "description": "Marks this nested field as keyword."
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Field name relative to its parent object."
        },
        "stored": {
          "type": "boolean",
          "description": "Keep raw keyword values for retrieval."
        },
        "indexed": {
          "type": "boolean",
          "description": "Index keyword terms for matching."
        },
        "fast": {
          "type": "boolean",
          "description": "Expose as a fast field to enable filters and aggregations."
        },
        "nullable": {
          "type": "boolean",
          "description": "Permit null values in documents for this field.",
          "default": false
        }
      }
    },
    "nested_numeric_property": {
      "type": "object",
      "description": "Numeric field within a nested object.",
      "additionalProperties": false,
      "required": ["type", "name", "i64", "fast"],
      "properties": {
        "type": {
          "const": "numeric",
          "description": "Marks this nested field as numeric."
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Field name relative to its parent object."
        },
        "i64": {
          "type": "boolean",
          "description": "When true store as a signed 64-bit integer; otherwise store as f64."
        },
        "fast": {
          "type": "boolean",
          "description": "Expose as a fast field to enable filters and aggregations."
        },
        "stored": {
          "type": "boolean",
          "description": "Keep numeric values in the doc store for retrieval.",
          "default": false
        },
        "nullable": {
          "type": "boolean",
          "description": "Permit null values in documents for this field.",
          "default": false
        }
      }
    },
    "nested_object_property": {
      "type": "object",
      "description": "Nested object contained within another nested object.",
      "additionalProperties": false,
      "required": ["type", "name"],
      "properties": {
        "type": {
          "const": "object",
          "description": "Marks this nested entry as another nested object."
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Name of the nested object relative to its parent."
        },
        "fields": {
          "type": "array",
          "description": "Child fields contained in this nested object.",
          "items": { "$ref": "#/$defs/nested_property" },
          "default": []
        },
        "nullable": {
          "type": "boolean",
          "description": "Allow the entire nested object to be null in documents.",
          "default": false
        }
      }
    },
    "vector_field": {
      "type": "object",
      "description": "Dense vector field configuration (requires the `vectors` feature).",
      "additionalProperties": false,
      "required": ["name", "dim", "metric"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Field name for vector embeddings."
        },
        "dim": {
          "type": "integer",
          "minimum": 1,
          "description": "Dimensionality of each vector."
        },
        "metric": {
          "type": "string",
          "enum": ["Cosine", "L2"],
          "description": "Similarity metric used for vector search."
        }
      }
    }
  }
}
